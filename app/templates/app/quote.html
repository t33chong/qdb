{% load app_tags %}
{% load ratings_tags %}

<pre>{{quote.text|urlize|target_blank|linebreaks}}</pre>
<small>Submitted by <a href="{% url 'app:user' quote.submitter.username %}">{{quote.submitter.username}}</a> at <a href="{% url 'app:detail' quote.id %}">{{quote.date}}</a></small>
<br>
<small>Tags:</small>
{% if quote.tags %}
<small>
{% for tag in quote.tags.all %}
<a href="{% url 'app:tag' tag.text %}">{{tag.text}}</a>{% if not forloop.last %}, {% endif %}
{% endfor %}
</small>
{% endif %}

{% get_rating_score for quote as score %}
{% if score %}
Average score: {{score.average|floatformat}}
<br>
Number of votes: {{score.num_votes}}
{% else %}
{% get_rating_form for quote as rating_form %}
<form action="{% url 'ratings_vote' %}" method="post">
  {% csrf_token %}
  {{rating_form}}
  <p><input type="submit" value="Vote &rarr;"></p>
</form>
{% endif %}
